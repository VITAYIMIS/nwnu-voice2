<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>智慧建言 - 数字化治理平台</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="智慧建言">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .glass-nav { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); }
        .card-gradient { background: linear-gradient(135deg, #ffffff 0%, #f0f7ff 100%); }
    </style>
</head>
<body class="pb-20">

    <nav class="glass-nav sticky top-0 z-50 px-6 py-4 flex justify-between items-center border-b border-gray-100">
        <div>
            <h1 class="text-xl font-bold text-blue-900">Campus Voice</h1>
            <p class="text-[10px] text-blue-400 font-medium tracking-widest uppercase">NWNU Digital Gov</p>
        </div>
        <div class="h-10 w-10 bg-blue-600 rounded-2xl flex items-center justify-center text-white font-bold shadow-lg shadow-blue-200">
            Y
        </div>
    </nav>

    <main class="px-6 mt-8">
        <header class="mb-8">
            <h2 class="text-3xl font-extrabold text-slate-800">最新建言公示</h2>
            <p class="text-slate-400 text-sm mt-2">透明治理 · 实时反馈 · 共同进步</p>
        </header>

        <div id="card-container" class="space-y-4">
            <div class="animate-pulse flex flex-col space-y-4">
                <div class="h-32 bg-gray-200 rounded-3xl"></div>
                <div class="h-32 bg-gray-200 rounded-3xl"></div>
            </div>
        </div>
    </main>

    <div class="fixed bottom-6 left-6 right-6">
        <button onclick="window.open('https://docs.qq.com/form/fill/XXXXXXXX')" class="w-full bg-slate-900 text-white py-4 rounded-3xl font-bold shadow-2xl shadow-slate-300 active:scale-95 transition-transform">
            提交新建议
        </button>
    </div>

    <script>
        // 你的腾讯文档 ID
        const DOC_ID = 'DWFR0b1N4S2N6RW5u';

        async function initProject() {
            try {
                // 1. 获取数据
                const response = await fetch(`https://docs.qq.com/d_util/v1/smartsheet/public_query?id=${DOC_ID}`);
                const result = await response.json();
                
                // 2. 提取并过滤数据
                const rows = result.data.rows;
                const publicEntries = rows.filter(row => {
                    const status = row.cells.find(c => c.field_name === '审核状态')?.value;
                    return status === '已公示';
                });

                // 3. 渲染页面
                renderCards(publicEntries);
            } catch (error) {
                console.error("加载失败:", error);
                document.getElementById('card-container').innerHTML = `
                    <div class="text-center py-10">
                        <p class="text-gray-400 text-sm">数据同步遇到小障碍，请刷新重试</p>
                    </div>`;
            }
        }

        function renderCards(data) {
            const container = document.getElementById('card-container');
            if (data.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-400 mt-10">暂无公示建议</p>';
                return;
            }

            container.innerHTML = data.map(item => {
                const getValue = (name) => item.cells.find(c => c.field_name === name)?.value || '未填写';
                
                return `
                    <div class="card-gradient p-6 rounded-[2rem] border border-white shadow-sm transition-all active:scale-[0.98]">
                        <div class="flex justify-between items-start mb-4">
                            <span class="px-3 py-1 bg-white/60 text-blue-500 text-[10px] font-bold rounded-full border border-blue-50">
                                ${getValue('分类')}
                            </span>
                            <span class="text-[10px] font-bold ${getValue('处理进展') === '已解决' ? 'text-green-500' : 'text-amber-500'}">
                                ● ${getValue('处理进展')}
                            </span>
                        </div>
                        <h3 class="text-lg font-bold text-slate-800 leading-snug mb-2">
                            ${getValue('标题')}
                        </h3>
                        <p class="text-slate-500 text-xs leading-relaxed line-clamp-2">
                            ${getValue('一句话摘要')}
                        </p>
                        <div class="mt-4 pt-4 border-t border-blue-100/50 flex items-center justify-between">
                            <span class="text-[10px] text-slate-400">${getValue('时间')}</span>
                            <div class="flex -space-x-2">
                                <div class="w-6 h-6 rounded-full border-2 border-white bg-blue-100 flex items-center justify-center text-[8px] font-bold text-blue-600">G</div>
                                <div class="w-6 h-6 rounded-full border-2 border-white bg-slate-800 flex items-center justify-center text-[8px] font-bold text-white">Y</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 启动启动！
        initProject();
    </script>
</body>
</html>
