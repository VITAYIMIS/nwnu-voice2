<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>è¥¿åŒ—å¸ˆå¤§æ™ºæ…§å»ºè¨€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f8fafc; font-family: system-ui, -apple-system, sans-serif; }
        .glass-header { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-bottom: 1px solid #e2e8f0; }
        /* åº•éƒ¨æ“ä½œæ æ¸å˜èƒŒæ™¯ */
        .bottom-action-area { background: linear-gradient(to top, #f8fafc 80%, rgba(248,250,252,0)); }
    </style>
</head>
<body class="pb-32">

    <nav class="glass-header sticky top-0 z-40 px-6 py-4">
        <h1 class="text-xl font-bold text-slate-900">è¥¿åŒ—å¸ˆå¤§æ ¡å­¦ç”Ÿä¼š</h1>
        <p class="text-[10px] text-blue-500 font-bold tracking-widest">æ™ºæ…§å»ºè¨€ Â· ç»“æœå…¬ç¤º</p>
    </nav>

    <main class="px-6 mt-6">
        <div class="mb-6 relative">
            <input type="text" id="searchInput" oninput="handleSearch()" placeholder="æœç´¢å…¬ç¤ºå»ºè¨€..." 
                   class="w-full bg-white border border-slate-200 rounded-xl p-3 pl-10 text-sm outline-none focus:ring-2 focus:ring-blue-500/20">
            <span class="absolute left-3 top-3.5 text-slate-400 text-lg">ğŸ”</span>
        </div>

        <div class="flex justify-between items-center mb-4">
            <h2 class="font-bold text-slate-800 italic">å…¬ç¤ºå»³ / GALLERY</h2>
            <span id="data-status" class="text-[9px] bg-slate-200 px-2 py-0.5 rounded text-slate-500 font-bold">åŒæ­¥ä¸­...</span>
        </div>

        <div id="card-container" class="space-y-4">
            <div class="py-12 text-center text-slate-300 text-xs italic">
                æ­£åœ¨å°è¯•ä»è…¾è®¯äº‘ç«¯åŒæ­¥æ•°æ®...<br>è¯·ç¡®ä¿è¡¨æ ¼å·²å¼€å¯â€œæ‰€æœ‰äººå¯æŸ¥çœ‹â€
            </div>
        </div>
    </main>

    <div class="fixed bottom-0 left-0 right-0 p-6 bottom-action-area z-50">
        <div class="max-w-md mx-auto">
            <button onclick="window.open('https://docs.qq.com/form/page/DWE9pVFphQ0VzeW5h', '_blank')" 
                    class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-2xl shadow-blue-200 active:scale-95 transition-all flex items-center justify-center space-x-2">
                <span class="text-xl">+</span>
                <span class="tracking-widest italic">æˆ‘è¦å‘èµ·å»ºè¨€</span>
            </button>
        </div>
    </div>

    <script>
        const SHEET_ID = 'DWGVVR0NqZUFza3pi'; // ä½ çš„å‰¯æœ¬ ID
        let allData = [];

        async function init() {
            const container = document.getElementById('card-container');
            const statusLabel = document.getElementById('data-status');
            
            try {
                // ä½¿ç”¨æ—¶é—´æˆ³å¼ºåˆ¶è·³è¿‡ç¼“å­˜
                const res = await fetch(`https://docs.qq.com/d_util/v1/smartsheet/public_query?id=${SHEET_ID}&_t=${Date.now()}`);
                
                if (!res.ok) {
                    statusLabel.innerText = "æƒé™å—é™";
                    container.innerHTML = `<div class="p-6 bg-white rounded-2xl border border-red-50 text-slate-400 text-xs text-center leading-relaxed">åŒæ­¥å¤±è´¥ã€‚è¯·åœ¨è¡¨æ ¼ã€åˆ†äº«ã€‘é‡Œè®¾ç½®ä¸ºã€æ‰€æœ‰äººå¯æŸ¥çœ‹ã€‘ã€‚<br>å½“å‰ä»£ç è¯·æ±‚ ID: ${SHEET_ID}</div>`;
                    return;
                }

                const json = await res.json();
                if (json.data && json.data.rows) {
                    allData = json.data.rows.filter(row => {
                        // å®½å®¹æ¨¡å¼åŒ¹é…ï¼šåªè¦åˆ—åé‡Œå¸¦ä»¥ä¸‹å…³é”®è¯å°±å°è¯•åŒ¹é…
                        const keywords = ['æ„è§', 'å…¬ç¤º', 'çŠ¶æ€', 'ç»“æœ'];
                        const cell = row.cells.find(c => c.field_name && keywords.some(k => c.field_name.includes(k)));
                        // ç¡®ä¿é€‰ä¸­äº†â€œå·²å…¬ç¤ºâ€é€‰é¡¹
                        return cell && String(cell.value).trim() === 'å·²å…¬ç¤º';
                    });
                    
                    statusLabel.innerText = `å·²åŒæ­¥ ${allData.length} æ¡`;
                    statusLabel.className = "text-[9px] bg-blue-50 px-2 py-0.5 rounded text-blue-500 font-bold";
                    render(allData);
                }
            } catch (err) {
                statusLabel.innerText = "ç½‘ç»œå¼‚å¸¸";
            }
        }

        function render(data) {
            const container = document.getElementById('card-container');
            if (data.length === 0) {
                container.innerHTML = `<div class="py-20 text-center text-slate-300 text-sm italic tracking-widest">æš‚æ— å…¬ç¤ºä¿¡æ¯<br><span class="text-[10px]">è¯·ç¡®è®¤è¡¨æ ¼ä¸­â€œå®¡æ ¸æ„è§â€åˆ—å·²å‹¾é€‰â€œå·²å…¬ç¤ºâ€</span></div>`;
                return;
            }
            container.innerHTML = data.map(row => {
                const getV = (name) => row.cells.find(c => c.field_name && c.field_name.includes(name))?.value || 'æœªå¡«';
                return `
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-[9px] font-bold text-blue-500 bg-blue-50 px-2 py-0.5 rounded uppercase tracking-tighter">${getV('åˆ†ç±»')}</span>
                            <span class="text-[9px] font-bold text-green-500 italic">â— å·²å…¬ç¤º</span>
                        </div>
                        <h3 class="font-bold text-slate-800 text-sm mb-2 leading-snug">${getV('æ ‡é¢˜')}</h3>
                        <p class="text-slate-500 text-[11px] leading-relaxed mb-4">${getV('ç°çŠ¶')}</p>
                        <div class="pt-4 border-t border-slate-50 flex justify-between items-center">
                            <span class="text-[8px] text-slate-300 font-medium">${getV('æ—¶é—´')}</span>
                            <span class="text-[8px] text-slate-400 font-black italic tracking-widest">NWNU SU</span>
                        </div>
                    </div>`;
            }).join('');
        }

        function handleSearch() {
            const k = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allData.filter(row => 
                row.cells.some(c => String(c.value || '').toLowerCase().includes(k))
            );
            render(filtered);
        }

        init();
    </script>
</body>
</html>
