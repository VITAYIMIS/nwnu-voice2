<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>è¥¿åŒ—å¸ˆå¤§æ ¡å­¦ç”Ÿä¼š - æ™ºæ…§å»ºè¨€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f8fafc; font-family: system-ui, -apple-system, sans-serif; -webkit-tap-highlight-color: transparent; }
        .glass-header { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-bottom: 1px solid #e2e8f0; }
        /* åº•éƒ¨èƒŒæ™¯æ¸å˜ï¼Œé˜²æ­¢å†…å®¹ä¸æŒ‰é’®é‡å  */
        .safe-area-bottom { padding-bottom: calc(env(safe-area-inset-bottom) + 90px); }
        .bottom-action-blur { background: linear-gradient(to top, #f8fafc 80%, rgba(248,250,252,0)); }
    </style>
</head>
<body class="safe-area-bottom">

    <nav class="glass-header sticky top-0 z-40 px-6 py-4">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold text-slate-900 leading-none">NWNU SU</h1>
                <p class="text-[10px] text-blue-500 font-bold tracking-widest uppercase mt-1">æ™ºæ…§å»ºè¨€ Â· æ•°å­—åŒ–å…¬ç¤º</p>
            </div>
            <div class="h-9 w-9 bg-slate-900 rounded-xl flex items-center justify-center text-white font-bold text-[10px]">å¸ˆå¤§</div>
        </div>
    </nav>

    <main class="px-6 mt-6">
        <div class="mb-6 relative">
            <input type="text" id="searchInput" oninput="handleSearch()" 
                   placeholder="æœç´¢å…³é”®è¯ï¼ˆå¦‚ï¼šé£Ÿå ‚ã€å®¿èˆï¼‰..." 
                   class="w-full bg-white border border-slate-200 rounded-2xl py-3 pl-11 pr-4 text-sm outline-none focus:ring-2 focus:ring-blue-500/20 shadow-sm transition-all">
            <span class="absolute left-4 top-3 text-slate-400">ğŸ”</span>
        </div>

        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-black text-slate-900 italic">å…¬ç¤ºå… / GALLERY</h2>
            <span id="data-status" class="text-[9px] bg-slate-200 px-2 py-0.5 rounded text-slate-500 font-bold uppercase tracking-tighter">åŒæ­¥ä¸­...</span>
        </div>

        <div id="card-container" class="space-y-4">
            <div class="py-20 text-center text-slate-300 text-xs italic">
                æ­£åœ¨è¿æ¥å¸ˆå¤§äº‘ç«¯æ•°æ®åº“...
            </div>
        </div>
    </main>

    <div class="fixed bottom-0 left-0 right-0 p-6 bottom-action-blur z-50">
        <div class="max-w-md mx-auto">
            <button onclick="window.open('https://docs.qq.com/form/page/DWE9pVFphQ0VzeW5h', '_blank')" 
                    class="w-full bg-blue-600 text-white py-4.5 rounded-[1.5rem] font-bold shadow-2xl shadow-blue-300 active:scale-95 transition-all flex items-center justify-center space-x-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                <span class="tracking-widest italic">æˆ‘è¦å‘èµ·å»ºè¨€</span>
            </button>
        </div>
    </div>

    <script>
        // ä½ çš„æ™ºèƒ½è¡¨æ ¼å‰¯æœ¬ ID
        const SHEET_ID = 'DWGVVR0NqZUFza3pi'; 
        let allData = [];

        async function init() {
            const container = document.getElementById('card-container');
            const statusLabel = document.getElementById('data-status');
            
            try {
                // å¼ºåˆ¶è·³è¿‡ç¼“å­˜ï¼Œå®æ—¶è·å–
                const res = await fetch(`https://docs.qq.com/d_util/v1/smartsheet/public_query?id=${SHEET_ID}&_t=${Date.now()}`);
                
                if (!res.ok) {
                    statusLabel.innerText = "è¿æ¥å¤±è´¥";
                    container.innerHTML = `<div class="p-6 bg-white rounded-2xl text-slate-400 text-xs text-center italic">æƒé™éªŒè¯æœªé€šè¿‡ï¼Œè¯·ç¡®ä¿è¡¨æ ¼å·²å¼€å¯â€œæ‰€æœ‰äººå¯æŸ¥çœ‹â€ã€‚</div>`;
                    return;
                }

                const json = await res.json();
                if (json.data && json.data.rows) {
                    // è¿‡æ»¤é€»è¾‘ï¼šåªè¦åˆ—åé‡Œå¸¦â€œæ„è§â€ä¸”é€‰é¡¹ä¸ºâ€œå·²å…¬ç¤ºâ€å°±æ˜¾ç¤º
                    allData = json.data.rows.filter(row => {
                        const cell = row.cells.find(c => c.field_name && c.field_name.includes('æ„è§'));
                        return cell && String(cell.value).trim() === 'å·²å…¬ç¤º';
                    });
                    
                    statusLabel.innerText = `å·²åŒæ­¥ ${allData.length} æ¡`;
                    statusLabel.className = "text-[9px] bg-blue-50 px-2 py-0.5 rounded text-blue-500 font-bold";
                    render(allData);
                }
            } catch (err) {
                statusLabel.innerText = "ç½‘ç»œå¼‚å¸¸";
            }
        }

        function render(data) {
            const container = document.getElementById('card-container');
            if (data.length === 0) {
                container.innerHTML = `<div class="py-20 text-center text-slate-300 text-sm italic tracking-widest">æš‚æ— å…¬ç¤ºä¿¡æ¯<br><span class="text-[10px]">ç®¡ç†å‘˜å®¡æ ¸é€šè¿‡å¹¶æ ‡è®°â€œå·²å…¬ç¤ºâ€åå°†åœ¨æ­¤æ˜¾ç¤º</span></div>`;
                return;
            }
            container.innerHTML = data.map(row => {
                const getV = (name) => row.cells.find(c => c.field_name && c.field_name.includes(name))?.value || 'æœªå¡«';
                return `
                    <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-50">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-[9px] font-black text-blue-500 bg-blue-50 px-2.5 py-1 rounded-lg border border-blue-100 uppercase tracking-tighter">${getV('åˆ†ç±»')}</span>
                            <span class="text-[9px] font-bold text-green-500 italic tracking-tighter">â— å·²å…¬ç¤º</span>
                        </div>
                        <h3 class="font-bold text-slate-800 text-sm mb-2 leading-snug">${getV('æ ‡é¢˜')}</h3>
                        <p class="text-slate-500 text-[11px] leading-relaxed mb-6 line-clamp-3">${getV('ç°çŠ¶')}</p>
                        <div class="pt-5 border-t border-slate-50 flex justify-between items-center">
                            <span class="text-[8px] text-slate-300 font-medium tracking-tighter">${getV('æ—¶é—´')}</span>
                            <span class="text-[8px] text-slate-400 font-black italic tracking-widest">NWNU SU</span>
                        </div>
                    </div>`;
            }).join('');
        }

        function handleSearch() {
            const k = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allData.filter(row => 
                row.cells.some(c => String(c.value || '').toLowerCase().includes(k))
            );
            render(filtered);
        }

        init();
    </script>
</body>
</html>
